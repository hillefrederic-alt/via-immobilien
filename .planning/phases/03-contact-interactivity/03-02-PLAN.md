---
phase: 03-contact-interactivity
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ContactMap.astro
autonomous: true

must_haves:
  truths:
    - "Map displays centered on Frankfurt/Rhein-Main region"
    - "Map is interactive - user can zoom and pan"
    - "Service area is visually indicated on map"
    - "OpenStreetMap attribution is visible"
  artifacts:
    - path: "src/components/ContactMap.astro"
      provides: "Interactive OpenStreetMap component"
      min_lines: 60
      contains: ["Leaflet", "openstreetmap.de", "L.map", "L.tileLayer"]
  key_links:
    - from: "src/components/ContactMap.astro"
      to: "OpenStreetMap tile server"
      via: "Leaflet tileLayer"
      pattern: "tile\\.openstreetmap\\.de"
---

<objective>
Create an interactive map component showing the Rhein-Main service area using Leaflet.js and GDPR-compliant German OpenStreetMap tile servers.

Purpose: Help visitors visualize the service area and understand that Via Immobilien operates in the Rhein-Main region around Frankfurt.

Output: ContactMap.astro component ready for integration into kontakt.astro
</objective>

<execution_context>
@/Users/frederichille/.claude/get-shit-done/workflows/execute-plan.md
@/Users/frederichille/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-contact-interactivity/03-RESEARCH.md
@src/styles/global.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ContactMap component with Leaflet.js</name>
  <files>src/components/ContactMap.astro</files>
  <action>
Create ContactMap.astro with:

**Map Container:**
- div with id="map" and class="contact-map"

**Leaflet Assets (CDN):**
- CSS: https://unpkg.com/leaflet@1.9.4/dist/leaflet.css
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
- JS: https://unpkg.com/leaflet@1.9.4/dist/leaflet.js
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin="" async

**Map Initialization Script:**
- Wait for Leaflet to load (check if L is defined, retry with setTimeout if not)
- Center: Frankfurt coordinates [50.1109, 8.6821]
- Zoom level: 10 (shows Rhein-Main region)

**Tile Layer (GDPR-friendly German server):**
- URL: 'https://tile.openstreetmap.de/{z}/{x}/{y}.png'
- maxZoom: 19
- Attribution: OpenStreetMap Contributors link

**Service Area Visualization:**
- Circle centered on Frankfurt
- Radius: 20000 (20km)
- Color: var(--color-gold) / #D1B787
- Fill opacity: 0.2
- Stroke weight: 2

**Optional Marker:**
- Marker at Frankfurt center
- Popup: "Via Immobilien - Rhein-Main-Region"

**Initialization Timing:**
- Check document.readyState
- If 'loading': add DOMContentLoaded listener
- Else: call initMap immediately
  </action>
  <verify>Component file exists with Leaflet initialization code</verify>
  <done>ContactMap.astro has complete Leaflet setup with German tile server and service area circle</done>
</task>

<task type="auto">
  <name>Task 2: Add responsive map styling</name>
  <files>src/components/ContactMap.astro</files>
  <action>
Add scoped styles to ContactMap.astro:

**Map Container:**
- Height: 400px (desktop)
- Width: 100%
- Border-radius: var(--border-radius-md)
- Overflow: hidden (ensures rounded corners work)

**Mobile Responsive:**
- @media (max-width: 768px): height 300px

**Leaflet Override (if needed):**
- Ensure map tiles fill container properly
- Handle any z-index issues with Leaflet controls
  </action>
  <verify>Map has proper dimensions and responsive behavior</verify>
  <done>ContactMap has responsive styling that fits the brand design</done>
</task>

</tasks>

<verification>
- [ ] ContactMap.astro exists in src/components/
- [ ] Leaflet CSS and JS loaded from unpkg CDN
- [ ] Map centered on Frankfurt coordinates
- [ ] German OSM tile server used (openstreetmap.de)
- [ ] Service area circle visible with gold color
- [ ] Attribution visible
- [ ] Responsive height (400px desktop, 300px mobile)
</verification>

<success_criteria>
ContactMap component displays interactive Rhein-Main region map with GDPR-compliant German tile server. Ready to be imported into kontakt.astro.
</success_criteria>

<output>
After completion, create `.planning/phases/03-contact-interactivity/03-02-SUMMARY.md`
</output>
