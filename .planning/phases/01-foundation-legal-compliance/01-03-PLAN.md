---
phase: 01-foundation-legal-compliance
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - src/pages/impressum.astro
  - src/pages/datenschutz.astro
  - src/components/CookieBanner.astro
  - src/scripts/cookieconsent.ts
  - src/layouts/BaseLayout.astro
  - package.json
autonomous: true

must_haves:
  truths:
    - "Impressum page exists at /impressum with all legally required information"
    - "Datenschutzerklarung page exists at /datenschutz with GDPR-compliant content"
    - "Both legal pages are accessible in one click from every page via footer"
    - "Cookie consent banner appears on first visit with opt-in/opt-out options"
    - "Cookie preferences can be changed after initial choice"
    - "Impressum includes real estate agent specific information (34c GewO placeholder)"
  artifacts:
    - path: "src/pages/impressum.astro"
      provides: "Legal Impressum page"
      contains: "34c GewO"
    - path: "src/pages/datenschutz.astro"
      provides: "Privacy policy page"
      contains: "DSGVO"
    - path: "src/components/CookieBanner.astro"
      provides: "Cookie consent integration"
      contains: "CookieConsent"
    - path: "src/scripts/cookieconsent.ts"
      provides: "Cookie consent configuration"
      contains: "vanilla-cookieconsent"
  key_links:
    - from: "src/layouts/BaseLayout.astro"
      to: "src/components/CookieBanner.astro"
      via: "import and render"
      pattern: "import.*CookieBanner"
    - from: "src/components/CookieBanner.astro"
      to: "src/scripts/cookieconsent.ts"
      via: "script import"
      pattern: "import.*cookieconsent"
---

<objective>
Create legally compliant Impressum and Datenschutzerklarung pages, and implement GDPR-compliant cookie consent banner.

Purpose: Fulfill German legal requirements (TMG SS 5, DSGVO) for business websites. A German real estate agent website MUST have these pages accessible or face fines up to 50,000 EUR.

Output: Working Impressum and Datenschutz pages with cookie consent functionality.
</objective>

<execution_context>
@/Users/frederichille/.claude/get-shit-done/workflows/execute-plan.md
@/Users/frederichille/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-legal-compliance/01-RESEARCH.md
@.planning/phases/01-foundation-legal-compliance/01-CONTEXT.md
@.planning/phases/01-foundation-legal-compliance/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Impressum page with real estate agent requirements</name>
  <files>
    src/pages/impressum.astro
  </files>
  <action>
    Create Impressum page at /impressum with all required information:

    1. Use BaseLayout with title "Impressum | Via Immobilien"

    2. Required content (SS 5 TMG):
       - Heading: "Impressum"
       - Company: Via Immobilien
       - Owner: Denise Semmel
       - Address: [PLACEHOLDER - needs real address]
       - Phone: +49 176 33445373
       - Email: denise@via-immobilien.de
       - Website: www.via-immobilien.de

    3. Real estate agent specific (SS 34c GewO) - CRITICAL from RESEARCH.md Pitfall 3:
       - Heading: "Berufsrechtliche Angaben"
       - Text: "Erlaubnis nach SS 34c Gewerbeordnung (GewO)"
       - Supervisory authority: [PLACEHOLDER - "Aufsichtsbehorde: [Zustandiges Ordnungsamt/Gewerbeamt eintragen]"]
       - Note: Add comment in code that user must fill in actual authority name

    4. EU Online Dispute Resolution:
       - Link: https://ec.europa.eu/consumers/odr
       - Text: "Plattform zur Online-Streitbeilegung"

    5. Liability disclaimer sections:
       - "Haftung fur Inhalte"
       - "Haftung fur Links"
       - "Urheberrecht"

    6. Styling:
       - Use semantic HTML (h1, h2, h3, p, address)
       - Clean typography using design tokens
       - Readable text width (max ~70ch for readability)
       - Adequate spacing between sections

    Add HTML comments marking PLACEHOLDER sections that need user input.
  </action>
  <verify>
    1. Navigate to /impressum - page loads without errors
    2. All required sections present (name, address placeholder, contact, SS 34c reference)
    3. Phone/email are clickable links
    4. Footer link to /impressum works from homepage
    5. Check page source for PLACEHOLDER comments
  </verify>
  <done>
    Impressum page with all required legal information and marked placeholders
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Datenschutzerklarung page</name>
  <files>
    src/pages/datenschutz.astro
  </files>
  <action>
    Create GDPR-compliant privacy policy at /datenschutz:

    1. Use BaseLayout with title "Datenschutzerklarung | Via Immobilien"

    2. Required DSGVO sections:
       - "Verantwortlicher" (controller) - same as Impressum contact
       - "Ihre Rechte" (data subject rights):
         - Auskunftsrecht (Art. 15 DSGVO)
         - Recht auf Berichtigung (Art. 16 DSGVO)
         - Recht auf Loschung (Art. 17 DSGVO)
         - Recht auf Einschrankung (Art. 18 DSGVO)
         - Recht auf Datenubertragbarkeit (Art. 20 DSGVO)
         - Widerspruchsrecht (Art. 21 DSGVO)
         - Beschwerderecht bei Aufsichtsbehorde

       - "Server-Log-Dateien" (hosting logs)
       - "Cookies" section explaining:
         - What cookies are used (currently: only consent cookie)
         - How to manage consent
         - Link to cookie settings (will be implemented)

       - "Kontaktformular" placeholder (for Phase 3)
       - "SSL-Verschlusselung" (HTTPS)

    3. Structure:
       - Table of contents at top with anchor links
       - Clear section headings (h2, h3)
       - Numbered list for rights
       - Last updated date at bottom

    4. Note: Use standard German legal language. Content can be adapted from
       e-Recht24 or Datenschutz-Generator templates as mentioned in RESEARCH.md.

    5. Styling:
       - Same clean layout as Impressum
       - Readable line length
       - Clear visual hierarchy
  </action>
  <verify>
    1. Navigate to /datenschutz - page loads without errors
    2. All DSGVO required sections present
    3. Table of contents links work (jump to sections)
    4. Footer link to /datenschutz works from homepage
    5. German text is correct (no Lorem ipsum)
  </verify>
  <done>
    Complete DSGVO-compliant Datenschutzerklarung page
  </done>
</task>

<task type="auto">
  <name>Task 3: Implement cookie consent banner</name>
  <files>
    src/components/CookieBanner.astro
    src/scripts/cookieconsent.ts
    src/layouts/BaseLayout.astro
    package.json
  </files>
  <action>
    Implement GDPR-compliant cookie consent using vanilla-cookieconsent:

    1. Install dependency:
       `npm install vanilla-cookieconsent`

    2. Create src/scripts/cookieconsent.ts:
       - Import vanilla-cookieconsent CSS and JS
       - Configure in German language
       - Categories:
         - "necessary" (always enabled, readonly) - consent storage
         - "analytics" (disabled by default) - placeholder for future
       - Modal text:
         - Title: "Wir verwenden Cookies"
         - Description: Explain purpose, link to /datenschutz
         - Buttons: "Alle akzeptieren", "Nur notwendige", "Einstellungen"
       - Preferences modal for granular control
       - Equal effort opt-in/opt-out (buttons same prominence)

       Reference RESEARCH.md Pattern 5 for configuration structure.

    3. Create src/components/CookieBanner.astro:
       - Import and initialize cookieconsent.ts as client-side script
       - Use client:load directive for immediate loading

    4. Update src/layouts/BaseLayout.astro:
       - Import CookieBanner component
       - Add <CookieBanner /> before closing </body>

    5. Styling considerations:
       - Banner should match site branding (use CSS overrides if needed)
       - Position: bottom of screen or modal
       - Accessible: keyboard navigable, sufficient contrast

    6. Script blocking setup (for future analytics):
       - Add comment explaining how to block scripts until consent
       - No actual blocking needed yet (no analytics in Phase 1)
  </action>
  <verify>
    1. Fresh browser (clear cookies) - banner appears on page load
    2. Click "Nur notwendige" - banner closes, choice saved
    3. Refresh page - banner does NOT reappear (consent stored)
    4. Clear cookies, reload - banner appears again
    5. Click "Einstellungen" - preferences modal opens
    6. Toggle analytics off/on - changes saved
    7. Check cookies in DevTools - cc_cookie or similar consent cookie exists
    8. Tab through banner - all buttons keyboard accessible
  </verify>
  <done>
    Cookie consent banner with GDPR-compliant opt-in/opt-out functionality
  </done>
</task>

</tasks>

<verification>
1. /impressum page accessible and contains all required legal information
2. /datenschutz page accessible and contains all DSGVO sections
3. Both pages use BaseLayout (header/footer consistent)
4. Cookie banner appears on first visit
5. Cookie consent persists across page refreshes
6. Footer links to both legal pages work from all pages
7. Impressum has SS 34c GewO reference with placeholder for authority
8. Equal-effort opt-in/opt-out buttons in cookie banner
</verification>

<success_criteria>
- Impressum is accessible in one click from every page (footer link)
- Datenschutzerklarung is accessible in one click from every page (footer link)
- Cookie consent banner displays on first visit
- Users can accept all, reject optional, or customize cookie preferences
- Consent choice is stored and banner doesn't reappear unnecessarily
- All Phase 1 Success Criteria from ROADMAP.md are now achievable:
  1. Impressum with Immobilienmakler licensing details (placeholders marked)
  2. Datenschutzerklarung with GDPR-compliant privacy policy
  3. (SSL via hosting - noted in Datenschutz)
  4. Cookie consent banner with equal-effort opt-in/opt-out
  5. Navigation header/footer on all pages (via BaseLayout)
  6. Responsive design (CSS foundation in place)
  7. Logo in header (placeholder until file provided)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-legal-compliance/01-03-SUMMARY.md`
</output>
