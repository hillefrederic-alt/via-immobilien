---
phase: 04-seo-performance
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - astro.config.mjs
  - src/layouts/BaseLayout.astro
autonomous: true

must_haves:
  truths:
    - "All pages have canonical URL meta tag"
    - "All pages have Open Graph meta tags (title, description, image, url)"
    - "Sitemap.xml is generated during build"
    - "Robots.txt is generated during build"
  artifacts:
    - path: "astro.config.mjs"
      provides: "Sitemap and robots.txt integrations"
      contains: "@astrojs/sitemap"
    - path: "src/layouts/BaseLayout.astro"
      provides: "SEO component with OG tags"
      contains: "astro-seo"
  key_links:
    - from: "src/layouts/BaseLayout.astro"
      to: "astro-seo"
      via: "import and component usage"
      pattern: "import.*SEO.*from.*astro-seo"
---

<objective>
Install and configure core SEO infrastructure: astro-seo component, sitemap generation, and robots.txt.

Purpose: Establish the technical foundation for all SEO features - meta tags, canonical URLs, Open Graph, and crawler directives.
Output: BaseLayout with astro-seo integration, configured sitemap and robots.txt generation.
</objective>

<execution_context>
@/Users/frederichille/.claude/get-shit-done/workflows/execute-plan.md
@/Users/frederichille/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-seo-performance/04-RESEARCH.md

Key findings from research:
- Use astro-seo component for type-safe meta tags and OG data
- @astrojs/sitemap auto-generates sitemap from routes
- astro-robots-txt generates robots.txt with sitemap reference
- Site config already set in astro.config.mjs: 'https://via-immobilien.de'
- Must use Astro.site for absolute URLs in OG images
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install SEO dependencies</name>
  <files>package.json</files>
  <action>
Install the three SEO packages:
```bash
npm install astro-seo @astrojs/sitemap astro-robots-txt
```

These packages provide:
- astro-seo: Type-safe SEO component with OG and Twitter card support
- @astrojs/sitemap: Official Astro sitemap generator
- astro-robots-txt: Robots.txt generator with sitemap reference
  </action>
  <verify>Run `npm list astro-seo @astrojs/sitemap astro-robots-txt` - all three packages listed</verify>
  <done>package.json includes astro-seo, @astrojs/sitemap, and astro-robots-txt as dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Configure Astro integrations</name>
  <files>astro.config.mjs</files>
  <action>
Update astro.config.mjs to add sitemap and robots.txt integrations:

```javascript
// @ts-check
import { defineConfig } from 'astro/config';
import sitemap from '@astrojs/sitemap';
import robotsTxt from 'astro-robots-txt';

export default defineConfig({
  site: 'https://via-immobilien.de',
  integrations: [
    sitemap({
      filter: (page) =>
        !page.includes('/danke/') &&     // Thank you page not indexed
        !page.includes('/kontakt-alt/')  // Alternative layout not indexed
    }),
    robotsTxt({
      sitemap: true,
      policy: [
        {
          userAgent: '*',
          allow: '/'
        }
      ]
    })
  ]
});
```

This configuration:
- Generates sitemap excluding thank-you and alternative pages
- Creates robots.txt with sitemap reference
- Allows all pages for crawling (no /admin or /preview directories exist)
  </action>
  <verify>Run `npm run build` - check dist/sitemap-*.xml and dist/robots.txt exist</verify>
  <done>Build generates sitemap-index.xml and robots.txt in dist/ folder</done>
</task>

<task type="auto">
  <name>Task 3: Update BaseLayout with astro-seo component</name>
  <files>src/layouts/BaseLayout.astro</files>
  <action>
Update BaseLayout.astro to use astro-seo component for all meta tags:

1. Add new prop `image` for OG image override
2. Import SEO component from astro-seo
3. Replace manual meta tags with SEO component
4. Generate canonical URL using Astro.url and Astro.site
5. Generate absolute OG image URL using Astro.site
6. Configure Open Graph with locale de_DE
7. Keep existing viewport, generator, favicon handling in extend section

Key patterns from research:
- Use `new URL(Astro.url.pathname, Astro.site)` for canonical
- Use `new URL(image, Astro.site).toString()` for absolute OG image
- Set twitter card to "summary_large_image"
- Include optional.locale as "de_DE"

Preserve existing:
- AOS initialization script
- Cookie banner inclusion
- Header and Footer components
- Global styles for body and main
  </action>
  <verify>Run `npm run dev`, view page source - check for og:title, og:description, og:image, canonical link tag</verify>
  <done>BaseLayout generates proper SEO meta tags including canonical URL and Open Graph tags with absolute URLs</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` succeeds without errors
2. `dist/sitemap-index.xml` exists and contains all public pages
3. `dist/robots.txt` exists with sitemap reference
4. View source of any page shows: canonical URL, og:title, og:description, og:image, twitter:card
5. OG image URL is absolute (starts with https://via-immobilien.de)
</verification>

<success_criteria>
- SEO packages installed and configured
- Sitemap generated with appropriate page filtering
- Robots.txt generated with sitemap reference
- All pages have canonical URLs via astro-seo component
- Open Graph tags present with absolute URLs
- Build process completes successfully
</success_criteria>

<output>
After completion, create `.planning/phases/04-seo-performance/04-01-SUMMARY.md`
</output>
