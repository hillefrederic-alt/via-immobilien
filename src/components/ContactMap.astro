---
/**
 * ContactMap.astro
 *
 * Interactive map component showing the Rhein-Main service area using Leaflet.js
 * and GDPR-compliant German OpenStreetMap tile servers.
 *
 * Features:
 * - Centered on Frankfurt/Rhein-Main region
 * - Service area visualization (20km radius)
 * - Interactive zoom and pan
 * - German OSM tile server (GDPR-compliant)
 * - Responsive design
 */
---

<!-- Leaflet CSS -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
  crossorigin=""
/>

<!-- Map Container -->
<div id="map" class="contact-map"></div>

<!-- Leaflet JS -->
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin=""
  async
></script>

<!-- Map Initialization Script -->
<script>
  // Frankfurt coordinates
  const FRANKFURT_COORDS = [50.1109, 8.6821];
  const SERVICE_RADIUS = 20000; // 20km in meters

  function initMap() {
    // Check if Leaflet is loaded
    if (typeof L === 'undefined') {
      setTimeout(initMap, 100);
      return;
    }

    // Initialize map
    const map = L.map('map', {
      center: FRANKFURT_COORDS,
      zoom: 10,
      scrollWheelZoom: true,
      zoomControl: true
    });

    // Add tile layer - German OSM server (GDPR-compliant)
    L.tileLayer('https://tile.openstreetmap.de/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Add service area circle
    const serviceArea = L.circle(FRANKFURT_COORDS, {
      color: '#D1B787', // var(--color-gold)
      fillColor: '#D1B787',
      fillOpacity: 0.2,
      weight: 2,
      radius: SERVICE_RADIUS
    }).addTo(map);

    // Add marker at Frankfurt center
    const marker = L.marker(FRANKFURT_COORDS).addTo(map);
    marker.bindPopup('<strong>Via Immobilien</strong><br>Rhein-Main-Region');

    // Optional: Open popup on load
    // marker.openPopup();
  }

  // Initialize map when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initMap);
  } else {
    initMap();
  }
</script>

<style>
  .contact-map {
    width: 100%;
    height: 400px;
    border-radius: var(--border-radius-md);
    overflow: hidden;
    box-shadow: var(--shadow-md);
  }

  /* Mobile responsive */
  @media (max-width: 768px) {
    .contact-map {
      height: 300px;
    }
  }

  /* Ensure Leaflet controls are properly positioned */
  :global(.leaflet-control) {
    z-index: 800;
  }
</style>
